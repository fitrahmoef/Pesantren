<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pendaftaran Santri Baru - Pondok Pesantren Mahmud Marzuki Penyasawan</title>

  <!-- ============== CSS ============== -->
  <style>
    /* ---------- palet warna ---------- */
    :root{
      --primary-blue:#1a75ff;
      --primary-yellow:#ffc107;
      --light-yellow:#fff3cd;
      --white:#fff;
      --dark-blue:#0d47a1;
      --light-blue:#e3f2fd;
      --gray:#f5f5f5;
      --error-red:#dc3545;
      --success-green:#28a745;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Helvetica,sans-serif;}
    body{background:var(--white);scroll-behavior:smooth;}

    .container{width:100%;max-width:1200px;margin:0 auto;padding:0 20px;}

    /* ---------- header ---------- */
    header{background:var(--light-blue);padding:20px 0;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.1);}
    .logo{width:120px;height:120px;border:5px solid var(--primary-yellow);border-radius:50%;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 0 14px rgba(0,0,0,.1);margin:0 auto;}
    .logo img{max-width:85%}
    
    header h1 {
      margin-top: 15px;
      color: var(--dark-blue);
      font-size: 1.7rem;
    }
    
    header h2 {
      font-size: 1.1rem;
      color: var(--primary-blue);
      font-weight: normal;
      margin-top: 5px;
    }

    .nav-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin:30px 0;}
    .nav-btn{background:var(--primary-blue);color:#fff;padding:14px 10px;border-radius:8px;font-weight:700;text-decoration:none;display:flex;flex-direction:column;align-items:center;transition:.3s;position:relative;}
    .nav-btn i{font-size:22px;margin-bottom:6px;}
    .nav-btn:hover,.nav-btn.active{background:var(--dark-blue);transform:translateY(-4px);}
    .nav-btn.active::after{content:"";position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);width:8px;height:8px;border-radius:50%;background:var(--primary-yellow);}

    /* ---------- form container ---------- */
    .form-container {
      background: var(--white);
      border-radius: 10px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      margin: 40px 0;
      overflow: hidden;
      opacity: 0;
      transform: translateY(30px);
      transition: .6s;
    }
    
    .form-container.show {
      opacity: 1;
      transform: none;
    }
    
    .form-header {
      background: var(--primary-blue);
      color: var(--white);
      padding: 20px;
      text-align: center;
    }
    
    .form-header h2 {
      font-size: 1.6rem;
      margin-bottom: 5px;
    }
    
    .form-header p {
      font-size: 0.95rem;
      opacity: 0.9;
    }
    
    /* ---------- step progress ---------- */
    .step-progress {
      display: flex;
      justify-content: space-between;
      padding: 30px 50px;
      background: var(--light-blue);
      position: relative;
    }
    
    .step-progress::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50px;
      right: 50px;
      height: 3px;
      background: var(--gray);
      transform: translateY(-50%);
      z-index: 1;
    }
    
    .progress-line {
      position: absolute;
      top: 50%;
      left: 50px;
      height: 3px;
      background: var(--primary-yellow);
      transform: translateY(-50%);
      z-index: 2;
      transition: width 0.3s;
    }
    
    .step {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--white);
      border: 3px solid var(--gray);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      position: relative;
      z-index: 3;
      transition: 0.3s;
    }
    
    .step.active {
      background: var(--primary-blue);
      border-color: var(--primary-blue);
      color: var(--white);
    }
    
    .step.completed {
      background: var(--primary-yellow);
      border-color: var(--primary-yellow);
      color: var(--dark-blue);
    }
    
    .step-label {
      position: absolute;
      top: 45px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      text-align: center;
      font-size: 0.8rem;
      color: var(--dark-blue);
      font-weight: 500;
    }
    
    /* ---------- form body ---------- */
    .form-body {
      padding: 30px;
    }
    
    .form-step {
      display: none;
    }
    
    .form-step.active {
      display: block;
      animation: fadeIn 0.5s;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .step-title {
      color: var(--dark-blue);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--light-blue);
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (min-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .form-grid.grid-3 {
        grid-template-columns: 1fr 1fr 1fr;
      }
      
      .full-width {
        grid-column: 1 / -1;
      }
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark-blue);
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: 0.3s;
    }
    
    .form-control:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(26, 117, 255, 0.2);
      outline: none;
    }
    
    .select-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      appearance: none;
      background: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e") no-repeat right 1rem center/1em;
      cursor: pointer;
    }
    
    .required::after {
      content: " *";
      color: var(--error-red);
    }
    
    .error-message {
      color: var(--error-red);
      font-size: 0.8rem;
      margin-top: 5px;
      display: none;
    }
    
    .form-group.has-error .form-control,
    .form-group.has-error .select-control {
      border-color: var(--error-red);
    }
    
    .form-group.has-error .error-message {
      display: block;
    }
    
    /* ---------- file upload ---------- */
    .file-upload {
      position: relative;
    }
    
    .file-label {
      display: block;
      padding: 20px;
      text-align: center;
      border: 2px dashed #ddd;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    
    .file-label:hover {
      border-color: var(--primary-blue);
      background: var(--light-blue);
    }
    
    .file-label i {
      font-size: 30px;
      color: var(--primary-blue);
      margin-bottom: 10px;
      display: block;
    }
    
    .file-input {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
    
    .file-info {
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--primary-blue);
    }
    
    /* ---------- payment info ---------- */
    .payment-info {
      background: var(--light-blue);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    
    .payment-details {
      background: var(--white);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border-left: 4px solid var(--primary-yellow);
    }
    
    .payment-details p {
      margin-bottom: 10px;
    }
    
    /* ---------- checkbox ---------- */
    .checkbox-group {
      margin: 20px 0;
    }
    
    .checkbox-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .checkbox-item input {
      margin-top: 5px;
      margin-right: 10px;
    }
    
    /* ---------- form navigation ---------- */
    .form-nav {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    
    .btn {
      display: inline-block;
      padding: 12px 25px;
      background: var(--primary-blue);
      color: var(--white);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    
    .btn:hover {
      background: var(--dark-blue);
      transform: translateY(-3px);
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-prev {
      background: var(--gray);
      color: var(--dark-blue);
    }
    
    .btn-prev:hover {
      background: #e0e0e0;
    }
    
    .btn-next {
      background: var(--primary-blue);
    }
    
    .btn-submit {
      background: var(--primary-yellow);
      color: var(--dark-blue);
    }
    
    .btn-submit:hover {
      background: #e6ad06;
    }
    
    /* ---------- success message ---------- */
    .success-message {
      text-align: center;
      padding: 50px 30px;
      display: none;
    }
    
    .success-icon {
      font-size: 80px;
      color: var(--success-green);
      margin-bottom: 20px;
    }
    
    .success-title {
      color: var(--dark-blue);
      margin-bottom: 20px;
    }
    
    .registration-number {
      font-size: 24px;
      font-weight: 700;
      padding: 15px;
      background: var(--light-yellow);
      border: 2px dashed var(--primary-yellow);
      border-radius: 8px;
      display: inline-block;
      margin: 20px 0;
      color: var(--dark-blue);
    }
    
    .btn-print {
      display: inline-block;
      padding: 12px 25px;
      background: var(--primary-blue);
      color: var(--white);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      margin-top: 20px;
      transition: 0.3s;
    }
    
    .btn-print:hover {
      background: var(--dark-blue);
      transform: translateY(-3px);
    }
    
    /* ---------- summary section ---------- */
    .summary-container {
      margin-bottom: 30px;
    }
    
    .summary-section {
      background: var(--light-blue);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .summary-section h4 {
      color: var(--dark-blue);
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    
    .summary-section p {
      margin-bottom: 10px;
    }

    /* ---------- loading overlay ---------- */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
      font-size: 18px;
    }

    .loading-content {
      text-align: center;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-blue);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ---------- notification ---------- */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 10000;
      animation: slideInRight 0.3s ease;
      max-width: 300px;
    }

    .notification.success {
      background: var(--success-green);
    }

    .notification.error {
      background: var(--error-red);
    }

    .notification.info {
      background: var(--primary-blue);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    /* ---------- footer ---------- */
    footer{background:var(--dark-blue);color:#fff;padding:40px 0 20px;margin-top:60px;}
    .foot-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:30px;}
    .foot-grid h3{color:var(--primary-yellow);margin-bottom:16px;border-bottom:1px solid var(--primary-yellow);padding-bottom:8px;}
    .foot-links a{display:block;color:#fff;text-decoration:none;margin-bottom:10px;transition:.3s;}
    .foot-links a:hover{color:var(--primary-yellow);transform:translateX(6px);}
    .copyright{text-align:center;margin-top:28px;font-size:.9rem;border-top:1px solid rgba(255,255,255,.15);padding-top:20px;}
    
    /* --- responsive styles --- */
    @media (max-width: 768px) {
      .step-progress {
        padding: 30px 20px;
      }
      
      .step-progress::before {
        left: 20px;
        right: 20px;
      }
      
      .progress-line {
        left: 20px;
      }
      
      .step {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
      }
      
      .step-label {
        width: 80px;
        font-size: 0.7rem;
      }
      
      .form-body {
        padding: 20px;
      }

      .notification {
        right: 10px;
        left: 10px;
        max-width: none;
      }
    }
  </style>

  <!-- ikon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
</head>
<body>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Mengirim data pendaftaran...</p>
      <p style="font-size: 14px; margin-top: 10px;">Mohon tunggu, jangan tutup halaman ini</p>
    </div>
  </div>

  <!-- ===== HEADER ===== -->
  <header id="header">
    <div class="container">
      <div class="logo"><img src="https://media-hosting.imagekit.io//08ea0aa2b86b45b3/c0a04346-1924-4d34-b66f-264de378d327.jpg?Expires=1835874188&Key-Pair-Id=K2ZIVPTIP2VGHC&Signature=XCy6xAnh8i-MkpspFbB4det~5sCPsTrEoxSoTgO9SZC2zbUh8rOYHthWOcpGLbFZfq0N6GtO9RW6PVt9ltOT8VYlUeAhF2CAVmP8vMVdRctpciTQa9jnkfPSATRdNYHL5-fLoI-LBanADmj4xwdmNsBol0YrxaLhKmOKbhOcSQL2f9Hnv~MUJLRQwmq~Hg9ehHKL5nXHNHb9WUOsgp-abUSCO1RUR8etdS9xFP4X2k0ODvI7Qsk-Fl7qrOWChimw1LGkapbOTjCwfWzhdy8S6q28foPnTrp1kycYanFKSZQbWx-rSmfSyPvL-ct7AYBbryOYQliILuaCEN5D7HjR9A__" alt="Logo" /></div>
      <h1>Pondok Pesantren Muhammadiyah Mahmud Marzuki</h1>
      <h2>Penyasawan, Kampar, Riau</h2>
    </div>
  </header>

  <!-- ===== NAV ===== -->
  <div class="container">
    <nav class="nav-grid">
      <a class="nav-btn" href="index.html"><i class="fas fa-home"></i>Beranda</a>
      <a class="nav-btn" href="history.html"><i class="fas fa-history"></i>Sejarah</a>
      <a class="nav-btn" href="academics.html"><i class="fas fa-book"></i>Program Akademik</a>
      <a class="nav-btn active" href="admissions.html"><i class="fas fa-user-graduate"></i>Admisi</a>
      <a class="nav-btn" href="islamic-studies.html"><i class="fas fa-mosque"></i>Pembelajaran Hadits</a>
      <a class="nav-btn" href="calendar.html"><i class="fas fa-calendar-alt"></i>Kalender</a>
    </nav>

    <!-- ===== FORM CONTAINER ===== -->
    <div class="form-container" id="formContainer">
      <div class="form-header">
        <h2>Pendaftaran Santri Baru</h2>
        <p>Tahun Ajaran 2025/2026</p>
      </div>
      
      <div class="step-progress">
        <div class="progress-line" id="progressLine"></div>
        <div class="step active" id="step-1">
          1
          <span class="step-label">Data Pribadi</span>
        </div>
        <div class="step" id="step-2">
          2
          <span class="step-label">Pendidikan</span>
        </div>
        <div class="step" id="step-3">
          3
          <span class="step-label">Dokumen</span>
        </div>
        <div class="step" id="step-4">
          4
          <span class="step-label">Pembayaran</span>
        </div>
        <div class="step" id="step-5">
          5
          <span class="step-label">Konfirmasi</span>
        </div>
      </div>
      
      <div class="form-body">
        <form id="registrationForm">
          <!-- STEP 1: DATA PRIBADI -->
          <div class="form-step active" id="form-step-1">
            <h3 class="step-title">Data Diri Calon Santri</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="fullname" class="required">Nama Lengkap</label>
                <input type="text" id="fullname" name="fullname" class="form-control" required>
                <div class="error-message">Nama lengkap harus diisi</div>
              </div>
              
              <div class="form-group">
                <label for="nickname">Nama Panggilan</label>
                <input type="text" id="nickname" name="nickname" class="form-control">
              </div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="birthplace" class="required">Tempat Lahir</label>
                <input type="text" id="birthplace" name="birthplace" class="form-control" required>
                <div class="error-message">Tempat lahir harus diisi</div>
              </div>
              
              <div class="form-group">
                <label for="birthdate" class="required">Tanggal Lahir</label>
                <input type="date" id="birthdate" name="birthdate" class="form-control" required>
                <div class="error-message">Tanggal lahir harus diisi</div>
              </div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="gender" class="required">Jenis Kelamin</label>
                <select id="gender" name="gender" class="select-control" required>
                  <option value="">Pilih Jenis Kelamin</option>
                  <option value="Laki-laki">Laki-laki</option>
                  <option value="Perempuan">Perempuan</option>
                </select>
                <div class="error-message">Jenis kelamin harus dipilih</div>
              </div>
              
              <div class="form-group">
                <label for="blood-type">Golongan Darah</label>
                <select id="blood-type" name="blood_type" class="select-control">
                  <option value="">Pilih Golongan Darah</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="AB">AB</option>
                  <option value="O">O</option>
                  <option value="Tidak Tahu">Tidak Tahu</option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label for="address" class="required">Alamat Lengkap</label>
              <textarea id="address" name="address" class="form-control" rows="3" required></textarea>
              <div class="error-message">Alamat lengkap harus diisi</div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="phone" class="required">Nomor HP (WhatsApp)</label>
                <input type="tel" id="phone" name="phone" class="form-control" placeholder="Contoh: 08123456789" required>
                <div class="error-message">Nomor HP harus diisi dengan benar</div>
              </div>
              
              <div class="form-group">
                <label for="email">Alamat Email (jika ada)</label>
                <input type="email" id="email" name="email" class="form-control" placeholder="Contoh: nama@gmail.com">
                <div class="error-message">Format email tidak valid</div>
              </div>
            </div>
            
            <h3 class="step-title">Data Orang Tua</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="father-name" class="required">Nama Ayah</label>
                <input type="text" id="father-name" name="father_name" class="form-control" required>
                <div class="error-message">Nama ayah harus diisi</div>
              </div>
              
              <div class="form-group">
                <label for="father-occupation" class="required">Pekerjaan Ayah</label>
                <input type="text" id="father-occupation" name="father_occupation" class="form-control" required>
                <div class="error-message">Pekerjaan ayah harus diisi</div>
              </div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="mother-name" class="required">Nama Ibu</label>
                <input type="text" id="mother-name" name="mother_name" class="form-control" required>
                <div class="error-message">Nama ibu harus diisi</div>
              </div>
              
              <div class="form-group">
                <label for="mother-occupation" class="required">Pekerjaan Ibu</label>
                <input type="text" id="mother-occupation" name="mother_occupation" class="form-control" required>
                <div class="error-message">Pekerjaan ibu harus diisi</div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="parent-phone" class="required">Nomor HP Orang Tua</label>
              <input type="tel" id="parent-phone" name="parent_phone" class="form-control" placeholder="Contoh: 08123456789" required>
              <div class="error-message">Nomor HP orang tua harus diisi dengan benar</div>
            </div>
            
            <div class="form-nav">
              <div></div>
              <button type="button" class="btn btn-next" id="step1Next">Selanjutnya <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>
          
          <!-- STEP 2: PENDIDIKAN -->
          <div class="form-step" id="form-step-2">
            <h3 class="step-title">Informasi Pendidikan</h3>
            
            <div class="form-group">
              <label for="education-level" class="required">Pendaftaran untuk Tingkat</label>
              <select id="education-level" name="education_level" class="select-control" required>
                <option value="">Pilih Tingkat Pendidikan</option>
                <option value="SLTP">SLTP (Tamatan SD/MI sederajat)</option>
                <option value="SLTA">SLTA (Tamatan SMP/MTs sederajat)</option>
              </select>
              <div class="error-message">Tingkat pendidikan harus dipilih</div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="previous-school" class="required">Asal Sekolah</label>
                <input type="text" id="previous-school" name="previous_school" class="form-control" required>
                <div class="error-message">Asal sekolah harus diisi</div>
              </div>
              
              <div class="form-group">
                <label for="graduation-year" class="required">Tahun Lulus</label>
                <select id="graduation-year" name="graduation_year" class="select-control" required>
                  <option value="">Pilih Tahun Lulus</option>
                  <option value="2025">2025</option>
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                </select>
                <div class="error-message">Tahun lulus harus dipilih</div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="nisn">NISN (jika ada)</label>
              <input type="text" id="nisn" name="nisn" class="form-control">
            </div>
            
            <h3 class="step-title">Informasi Kemampuan</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="quran-ability" class="required">Kemampuan Membaca Al-Quran</label>
                <select id="quran-ability" name="quran_ability" class="select-control" required>
                  <option value="">Pilih Tingkat Kemampuan</option>
                  <option value="Belum Bisa">Belum Bisa</option>
                  <option value="Pemula">Pemula (Iqra)</option>
                  <option value="Menengah">Menengah (Bisa membaca Al-Quran)</option>
                  <option value="Lancar">Lancar Membaca</option>
                  <option value="Hafal Juz Amma">Hafal Juz Amma</option>
                  <option value="Hafal Beberapa Juz">Hafal Beberapa Juz</option>
                </select>
                <div class="error-message">Kemampuan membaca Al-Quran harus dipilih</div>
              </div>
              
              <div class="form-group">
                <label for="shalat-ability" class="required">Kemampuan Shalat</label>
                <select id="shalat-ability" name="shalat_ability" class="select-control" required>
                  <option value="">Pilih Tingkat Kemampuan</option>
                  <option value="Belum Bisa">Belum Bisa</option>
                  <option value="Masih Belajar">Masih Belajar</option>
                  <option value="Bisa dengan Panduan">Bisa dengan Panduan</option>
                  <option value="Mandiri">Bisa Mandiri</option>
                </select>
                <div class="error-message">Kemampuan shalat harus dipilih</div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="achievements">Prestasi yang Pernah Diraih (jika ada)</label>
              <textarea id="achievements" name="achievements" class="form-control" rows="3" placeholder="Contoh: Juara 1 Lomba Tahfidz Tingkat Kecamatan"></textarea>
            </div>
            
            <div class="form-nav">
              <button type="button" class="btn btn-prev" id="step2Prev"><i class="fas fa-arrow-left"></i> Sebelumnya</button>
              <button type="button" class="btn btn-next" id="step2Next">Selanjutnya <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>
          
          <!-- STEP 3: DOKUMEN -->
          <div class="form-step" id="form-step-3">
            <h3 class="step-title">Unggah Dokumen</h3>
            <p style="margin-bottom: 20px;">Mohon siapkan dokumen dalam format JPG, PNG, atau PDF dengan ukuran maksimal 2MB per file.</p>
            
            <div class="form-group">
              <label for="photo" class="required">Pas Foto 3x4</label>
              <div class="file-upload">
                <div class="file-label">
                  <i class="fas fa-upload"></i>
                  <p>Klik atau seret file ke sini</p>
                </div>
                <input type="file" id="photo" name="photo" class="file-input" accept="image/*" required>
              </div>
              <div class="file-info" id="photo-info">Belum ada file dipilih</div>
              <div class="error-message">Pas foto harus diunggah</div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="birth-certificate" class="required">Akta Kelahiran</label>
                <div class="file-upload">
                  <div class="file-label">
                    <i class="fas fa-upload"></i>
                    <p>Klik atau seret file ke sini</p>
                  </div>
                  <input type="file" id="birth-certificate" name="birth_certificate" class="file-input" accept="image/*,application/pdf" required>
                </div>
                <div class="file-info" id="birth-certificate-info">Belum ada file dipilih</div>
                <div class="error-message">Akta kelahiran harus diunggah</div>
              </div>
              
              <div class="form-group">
                <label for="family-card" class="required">Kartu Keluarga</label>
                <div class="file-upload">
                  <div class="file-label">
                    <i class="fas fa-upload"></i>
                    <p>Klik atau seret file ke sini</p>
                  </div>
                  <input type="file" id="family-card" name="family_card" class="file-input" accept="image/*,application/pdf" required>
                </div>
                <div class="file-info" id="family-card-info">Belum ada file dipilih</div>
                <div class="error-message">Kartu keluarga harus diunggah</div>
              </div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="parent-id" class="required">KTP Orang Tua</label>
                <div class="file-upload">
                  <div class="file-label">
                    <i class="fas fa-upload"></i>
                    <p>Klik atau seret file ke sini</p>
                  </div>
                  <input type="file" id="parent-id" name="parent_id" class="file-input" accept="image/*,application/pdf" required>
                </div>
                <div class="file-info" id="parent-id-info">Belum ada file dipilih</div>
                <div class="error-message">KTP orang tua harus diunggah</div>
              </div>
              
              <div class="form-group">
                <label for="report-card" class="required">Rapor Terakhir</label>
                <div class="file-upload">
                  <div class="file-label">
                    <i class="fas fa-upload"></i>
                    <p>Klik atau seret file ke sini</p>
                  </div>
                  <input type="file" id="report-card" name="report_card" class="file-input" accept="image/*,application/pdf" required>
                </div>
                <div class="file-info" id="report-card-info">Belum ada file dipilih</div>
                <div class="error-message">Rapor terakhir harus diunggah</div>
              </div>
            </div>
            
            <div class="form-nav">
              <button type="button" class="btn btn-prev" id="step3Prev"><i class="fas fa-arrow-left"></i> Sebelumnya</button>
              <button type="button" class="btn btn-next" id="step3Next">Selanjutnya <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>
          
          <!-- STEP 4: PEMBAYARAN -->
          <div class="form-step" id="form-step-4">
            <h3 class="step-title">Informasi Pembayaran</h3>
            
            <div class="payment-info">
              <p>Biaya pendaftaran sebesar <strong>Rp. 50.000</strong> dapat dibayarkan melalui transfer bank.</p>
              <div class="payment-details">
                <p><strong>Bank:</strong> BRKS Bangkinang</p>
                <p><strong>No. Rekening:</strong> 109-43-02536</p>
                <p><strong>Atas Nama:</strong> Pondok Pesantren Mahmud Marzuki Penyasawan</p>
              </div>
            </div>
            
            <div class="form-group">
              <label for="payment-proof" class="required">Bukti Pembayaran</label>
              <div class="file-upload">
                <div class="file-label">
                  <i class="fas fa-upload"></i>
                  <p>Klik atau seret file bukti pembayaran ke sini</p>
                </div>
                <input type="file" id="payment-proof" name="payment_proof" class="file-input" accept="image/*,application/pdf" required>
              </div>
              <div class="file-info" id="payment-proof-info">Belum ada file dipilih</div>
              <div class="error-message">Bukti pembayaran harus diunggah</div>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="payment-date" class="required">Tanggal Pembayaran</label>
                <input type="date" id="payment-date" name="payment_date" class="form-control" required>
                <div class="error-message">Tanggal pembayaran harus diisi</div>
              </div>
              
              <div class="form-group">
                <label for="payment-name" class="required">Nama Pengirim</label>
                <input type="text" id="payment-name" name="payment_name" class="form-control" required>
                <div class="error-message">Nama pengirim harus diisi</div>
              </div>
            </div>
            
            <div class="form-nav">
              <button type="button" class="btn btn-prev" id="step4Prev"><i class="fas fa-arrow-left"></i> Sebelumnya</button>
              <button type="button" class="btn btn-next" id="step4Next">Selanjutnya <i class="fas fa-arrow-right"></i></button>
            </div>
          </div>
          
          <!-- STEP 5: KONFIRMASI -->
          <div class="form-step" id="form-step-5">
            <h3 class="step-title">Konfirmasi Data</h3>
            <p style="margin-bottom: 20px;">Silakan periksa kembali data yang telah diisi. Pastikan semua informasi yang dimasukkan sudah benar.</p>
            
            <div id="summary-container" class="summary-container">
              <!-- Data will be generated by JavaScript -->
            </div>
            
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms" class="required">Saya menyatakan bahwa data yang saya masukkan adalah benar dan dapat dipertanggungjawabkan.</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="rules" name="rules" required>
                <label for="rules" class="required">Saya bersedia mematuhi semua peraturan Pondok Pesantren Mahmud Marzuki Penyasawan.</label>
              </div>
            </div>
            
            <div class="form-nav">
              <button type="button" class="btn btn-prev" id="step5Prev"><i class="fas fa-arrow-left"></i> Sebelumnya</button>
              <button type="submit" class="btn btn-submit" id="submitForm">Kirim Pendaftaran <i class="fas fa-paper-plane"></i></button>
            </div>
          </div>
        </form>
        
        <!-- SUCCESS MESSAGE -->
        <div class="success-message" id="successMessage">
          <i class="fas fa-check-circle success-icon"></i>
          <h2 class="success-title">Pendaftaran Berhasil!</h2>
          <p>Alhamdulillah, pendaftaran Anda telah berhasil dikirim.</p>
          <p>Nomor Pendaftaran:</p>
          <div class="registration-number" id="registrationNumber">PPMMP-2025-0001</div>
          <p>Mohon simpan nomor pendaftaran ini untuk keperluan selanjutnya.</p>
          <p>Informasi selanjutnya akan dikirimkan melalui nomor WhatsApp yang telah Anda daftarkan.</p>
          <a href="#" class="btn-print" id="printButton"><i class="fas fa-print"></i> Cetak Bukti Pendaftaran</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== FOOTER ===== -->
  <footer>
    <div class="container">
      <div class="foot-grid">
        <div>
          <h3>Contact Us</h3>
          <p><i class="fas fa-map-marker-alt"></i> Penyasawan, Kampar, Riau</p>
          <p><i class="fas fa-phone"></i> 0000000000000</p>
          <p><i class="fas fa-envelope"></i> info@mahmudmarzukipenyasawan.org</p>
        </div>
        <div>
          <h3>Quick Links</h3>
          <div class="foot-links">
            <a href="index.html"><i class="fas fa-angle-right"></i> Beranda</a>
            <a href="academics.html"><i class="fas fa-angle-right"></i> Program Akademik</a>
            <a href="islamic-studies.html"><i class="fas fa-angle-right"></i> Studi Islam</a>
            <a href="admissions.html"><i class="fas fa-angle-right"></i> Admisi</a>
          </div>
        </div>
        <div>
          <h3>Connect</h3>
          <div class="foot-links">
            <a href="#"><i class="fab fa-facebook"></i> Facebook</a>
            <a href="#"><i class="fab fa-instagram"></i> Instagram</a>
            <a href="#"><i class="fab fa-youtube"></i> YouTube</a>
          </div>
        </div>
      </div>
      <p class="copyright">&copy; 2025 Mahmud Marzuki Penyasawan. Semua hak cipta dilindungi.</p>
    </div>
  </footer>

  <!-- ============== JavaScript ============== -->
  <script>
    // ============== CONFIGURATION ==============
    // TODO: Ganti dengan URL Google Apps Script yang sudah di-deploy
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
    
    // ============== GLOBAL VARIABLES ==============
    let currentStep = 1;
    const totalSteps = 5;
    
    // ============== DOM ELEMENTS ==============
    const formContainer = document.getElementById('formContainer');
    const form = document.getElementById('registrationForm');
    const formSteps = document.querySelectorAll('.form-step');
    const steps = document.querySelectorAll('.step');
    const progressLine = document.getElementById('progressLine');
    const successMessage = document.getElementById('successMessage');
    const loadingOverlay = document.getElementById('loadingOverlay');
    
    // Navigation buttons
    const step1Next = document.getElementById('step1Next');
    const step2Prev = document.getElementById('step2Prev');
    const step2Next = document.getElementById('step2Next');
    const step3Prev = document.getElementById('step3Prev');
    const step3Next = document.getElementById('step3Next');
    const step4Prev = document.getElementById('step4Prev');
    const step4Next = document.getElementById('step4Next');
    const step5Prev = document.getElementById('step5Prev');
    const submitForm = document.getElementById('submitForm');
    
    // ============== INITIALIZATION ==============
    document.addEventListener('DOMContentLoaded', function() {
      // Form container animation
      setTimeout(() => {
        formContainer.classList.add('show');
      }, 300);
      
      // Setup event listeners
      setupEventListeners();
      
      // Setup file upload handlers
      setupFileUploads();
      
      // Setup phone number formatting
      setupPhoneFormatting();
      
      // Initialize progress
      updateProgress();
      
      console.log('Form initialized successfully');
    });
    
    // ============== EVENT LISTENERS SETUP ==============
    function setupEventListeners() {
      // Navigation events
      step1Next.addEventListener('click', () => {
        if (validateStep(1)) {
          goToStep(2);
        }
      });
      
      step2Prev.addEventListener('click', () => {
        goToStep(1);
      });
      
      step2Next.addEventListener('click', () => {
        if (validateStep(2)) {
          goToStep(3);
        }
      });
      
      step3Prev.addEventListener('click', () => {
        goToStep(2);
      });
      
      step3Next.addEventListener('click', () => {
        if (validateStep(3)) {
          goToStep(4);
        }
      });
      
      step4Prev.addEventListener('click', () => {
        goToStep(3);
      });
      
      step4Next.addEventListener('click', () => {
        if (validateStep(4)) {
          generateSummary();
          goToStep(5);
        }
      });
      
      step5Prev.addEventListener('click', () => {
        goToStep(4);
      });
      
      // Form submission
      form.addEventListener('submit', handleFormSubmission);
      
      // Print functionality
      document.getElementById('printButton').addEventListener('click', printReceipt);
      
      // Real-time validation
      setupRealTimeValidation();
    }
    
    // ============== STEP NAVIGATION ==============
    function goToStep(step) {
      if (step < 1 || step > totalSteps) return;
      
      // Update form steps
      formSteps.forEach((formStep, index) => {
        formStep.classList.remove('active');
        
        if (index + 1 === step) {
          formStep.classList.add('active');
        }
      });
      
      // Update step indicators
      steps.forEach((stepElement, index) => {
        stepElement.classList.remove('active', 'completed');
        
        if (index + 1 < step) {
          stepElement.classList.add('completed');
        } else if (index + 1 === step) {
          stepElement.classList.add('active');
        }
      });
      
      currentStep = step;
      updateProgress();
      
      // Scroll to top of form
      formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      console.log(`Moved to step ${step}`);
    }
    
    function updateProgress() {
      const percent = ((currentStep - 1) / (totalSteps - 1)) * 100;
      progressLine.style.width = `${percent}%`;
    }
    
    // ============== VALIDATION ==============
    function validateStep(step) {
      const activeStep = document.getElementById(`form-step-${step}`);
      const requiredFields = activeStep.querySelectorAll('[required]');
      let isValid = true;
      
      requiredFields.forEach(field => {
        if (!validateField(field)) {
          isValid = false;
        }
      });
      
      if (!isValid) {
        showNotification('Mohon lengkapi semua field yang diperlukan', 'error');
      }
      
      return isValid;
    }
    
    function validateField(field) {
      const formGroup = field.closest('.form-group') || field.closest('.checkbox-item');
      
      // Remove previous error state
      formGroup.classList.remove('has-error');
      
      let isValid = true;
      
      if (field.type === 'file') {
        if (field.files.length === 0) {
          formGroup.classList.add('has-error');
          isValid = false;
        }
      } else if (field.type === 'checkbox') {
        if (!field.checked) {
          formGroup.classList.add('has-error');
          isValid = false;
        }
      } else {
        const value = field.value.trim();
        
        if (value === '') {
          formGroup.classList.add('has-error');
          isValid = false;
        } else {
          // Additional specific validations
          if (field.type === 'email' && value !== '') {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) {
              formGroup.classList.add('has-error');
              isValid = false;
            }
          }
          
          if (field.type === 'tel') {
            const phoneRegex = /^(\+62|62|0)8[1-9][0-9]{6,9}$/;
            if (!phoneRegex.test(value.replace(/\s+/g, ''))) {
              formGroup.classList.add('has-error');
              isValid = false;
            }
          }
          
          if (field.type === 'date') {
            const selectedDate = new Date(value);
            const minDate = new Date('1900-01-01');
            const maxDate = new Date();
            
            if (selectedDate < minDate || selectedDate > maxDate) {
              formGroup.classList.add('has-error');
              isValid = false;
            }
          }
        }
      }
      
      return isValid;
    }
    
    function setupRealTimeValidation() {
      const allInputs = form.querySelectorAll('input, select, textarea');
      
      allInputs.forEach(input => {
        // Validate on blur for better UX
        input.addEventListener('blur', function() {
          if (this.hasAttribute('required') || this.value.trim() !== '') {
            validateField(this);
          }
        });
        
        // Clear error state on input
        input.addEventListener('input', function() {
          const formGroup = this.closest('.form-group') || this.closest('.checkbox-item');
          if (formGroup.classList.contains('has-error')) {
            formGroup.classList.remove('has-error');
          }
        });
      });
    }
    
    // ============== FILE UPLOAD HANDLING ==============
    function setupFileUploads() {
      const fileInputs = document.querySelectorAll('.file-input');
      
      fileInputs.forEach(input => {
        input.addEventListener('change', function() {
          handleFileUpload(this);
        });
        
        // Drag and drop functionality
        const fileLabel = input.parentNode.querySelector('.file-label');
        
        fileLabel.addEventListener('dragover', function(e) {
          e.preventDefault();
          this.style.borderColor = 'var(--primary-blue)';
          this.style.background = 'var(--light-blue)';
        });
        
        fileLabel.addEventListener('dragleave', function(e) {
          e.preventDefault();
          this.style.borderColor = '#ddd';
          this.style.background = 'transparent';
        });
        
        fileLabel.addEventListener('drop', function(e) {
          e.preventDefault();
          this.style.borderColor = '#ddd';
          this.style.background = 'transparent';
          
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            input.files = files;
            handleFileUpload(input);
          }
        });
      });
    }
    
    function handleFileUpload(input) {
      const fileInfo = document.getElementById(`${input.id}-info`);
      const formGroup = input.closest('.form-group');
      
      if (input.files.length > 0) {
        const file = input.files[0];
        const fileSize = (file.size / 1024 / 1024).toFixed(2); // Convert to MB
        
        // Validate file size (max 2MB)
        if (parseFloat(fileSize) > 2) {
          fileInfo.textContent = `${file.name} - Ukuran file terlalu besar (max 2MB)`;
          fileInfo.style.color = 'var(--error-red)';
          input.value = ''; // Reset file input
          formGroup.classList.add('has-error');
          return;
        }
        
        // Validate file type
        const allowedTypes = input.getAttribute('accept').split(',');
        const fileType = file.type;
        const isValidType = allowedTypes.some(type => {
          if (type.trim() === 'image/*') {
            return fileType.startsWith('image/');
          } else if (type.trim() === 'application/pdf') {
            return fileType === 'application/pdf';
          }
          return fileType === type.trim();
        });
        
        if (!isValidType) {
          fileInfo.textContent = `${file.name} - Format file tidak didukung`;
          fileInfo.style.color = 'var(--error-red)';
          input.value = '';
          formGroup.classList.add('has-error');
          return;
        }
        
        // File is valid
        fileInfo.textContent = `${file.name} (${fileSize} MB)`;
        fileInfo.style.color = 'var(--success-green)';
        formGroup.classList.remove('has-error');
        
      } else {
        fileInfo.textContent = 'Belum ada file dipilih';
        fileInfo.style.color = 'var(--primary-blue)';
      }
    }
    
    // ============== PHONE NUMBER FORMATTING ==============
    function setupPhoneFormatting() {
      const phoneInputs = document.querySelectorAll('input[type="tel"]');
      
      phoneInputs.forEach(input => {
        input.addEventListener('input', function() {
          let value = this.value.replace(/\D/g, ''); // Remove non-digits
          
          // Format Indonesian phone numbers
          if (value.startsWith('62')) {
            value = '0' + value.substring(2);
          } else if (value.startsWith('8')) {
            value = '0' + value;
          }
          
          this.value = value;
        });
        
        input.addEventListener('keypress', function(e) {
          // Only allow numbers
          if (!/\d/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Enter'].includes(e.key)) {
            e.preventDefault();
          }
        });
      });
    }
    
    // ============== SUMMARY GENERATION ==============
    function generateSummary() {
      const summaryContainer = document.getElementById('summary-container');
      const formData = new FormData(form);
      
      let summaryHTML = '';
      
      // Personal data
      summaryHTML += `
        <div class="summary-section">
          <h4>Data Pribadi</h4>
          <p><strong>Nama Lengkap:</strong> ${formData.get('fullname') || '-'}</p>
          <p><strong>Nama Panggilan:</strong> ${formData.get('nickname') || '-'}</p>
          <p><strong>Tempat, Tanggal Lahir:</strong> ${formData.get('birthplace') || '-'}, ${formatDate(formData.get('birthdate'))}</p>
          <p><strong>Jenis Kelamin:</strong> ${formData.get('gender') || '-'}</p>
          <p><strong>Golongan Darah:</strong> ${formData.get('blood_type') || '-'}</p>
          <p><strong>Alamat:</strong> ${formData.get('address') || '-'}</p>
          <p><strong>No. HP:</strong> ${formData.get('phone') || '-'}</p>
          <p><strong>Email:</strong> ${formData.get('email') || '-'}</p>
        </div>
      `;
      
      // Parent data
      summaryHTML += `
        <div class="summary-section">
          <h4>Data Orang Tua</h4>
          <p><strong>Nama Ayah:</strong> ${formData.get('father_name') || '-'}</p>
          <p><strong>Pekerjaan Ayah:</strong> ${formData.get('father_occupation') || '-'}</p>
          <p><strong>Nama Ibu:</strong> ${formData.get('mother_name') || '-'}</p>
          <p><strong>Pekerjaan Ibu:</strong> ${formData.get('mother_occupation') || '-'}</p>
          <p><strong>No. HP Orang Tua:</strong> ${formData.get('parent_phone') || '-'}</p>
        </div>
      `;
      
      // Education data
      summaryHTML += `
        <div class="summary-section">
          <h4>Data Pendidikan</h4>
          <p><strong>Pendaftaran untuk Tingkat:</strong> ${formData.get('education_level') || '-'}</p>
          <p><strong>Asal Sekolah:</strong> ${formData.get('previous_school') || '-'}</p>
          <p><strong>Tahun Lulus:</strong> ${formData.get('graduation_year') || '-'}</p>
          <p><strong>NISN:</strong> ${formData.get('nisn') || '-'}</p>
          <p><strong>Kemampuan Membaca Al-Quran:</strong> ${formData.get('quran_ability') || '-'}</p>
          <p><strong>Kemampuan Shalat:</strong> ${formData.get('shalat_ability') || '-'}</p>
          <p><strong>Prestasi:</strong> ${formData.get('achievements') || '-'}</p>
        </div>
      `;
      
      // Payment data
      summaryHTML += `
        <div class="summary-section">
          <h4>Data Pembayaran</h4>
          <p><strong>Tanggal Pembayaran:</strong> ${formatDate(formData.get('payment_date'))}</p>
          <p><strong>Nama Pengirim:</strong> ${formData.get('payment_name') || '-'}</p>
        </div>
      `;
      
      summaryContainer.innerHTML = summaryHTML;
    }
    
    // ============== FORM SUBMISSION ==============
    async function handleFormSubmission(e) {
      e.preventDefault();
      
      if (!validateStep(5)) {
        return;
      }
      
      // Show loading
      showLoading();
      
      try {
        const formData = new FormData(form);
        
        // Convert FormData to regular object (excluding files for now)
        const jsonData = formDataToJSON(formData);
        
        // Send to Google Apps Script
        const result = await sendToGoogleSheets(jsonData);
        
        if (result.success) {
          showSuccess(result.registrationNumber);
          
          // Save to localStorage for receipt
          localStorage.setItem('lastRegistrationNumber', result.registrationNumber);
          localStorage.setItem('registrationData', JSON.stringify(jsonData));
          
          showNotification('Pendaftaran berhasil dikirim!', 'success');
        } else {
          throw new Error(result.message || 'Gagal mengirim data');
        }
        
      } catch (error) {
        console.error('Submission error:', error);
        showNotification(`Terjadi kesalahan: ${error.message}`, 'error');
      } finally {
        hideLoading();
      }
    }
    
    async function sendToGoogleSheets(data) {
      try {
        console.log('Sending data to Google Sheets:', data);
        
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors', // Required for Google Apps Script
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        // With no-cors mode, we can't read the response
        // So we'll assume success if no error is thrown
        // In production, you might want to implement a webhook or alternative verification
        
        return {
          success: true,
          registrationNumber: generateClientRegistrationNumber()
        };
        
      } catch (error) {
        console.error('Error sending to Google Sheets:', error);
        throw new Error('Gagal mengirim data ke server. Silakan periksa koneksi internet dan coba lagi.');
      }
    }
    
    function formDataToJSON(formData) {
      const object = {};
      for (const [key, value] of formData.entries()) {
        // Skip file inputs (they need special handling)
        if (typeof value === 'string') {
          object[key] = value;
        }
      }
      
      // Add timestamp
      object.timestamp = new Date().toISOString();
      
      return object;
    }
    
    function generateClientRegistrationNumber() {
      const year = new Date().getFullYear();
      const timestamp = Date.now();
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      
      return `PPMMP-${year}-${random}${timestamp.toString().slice(-3)}`;
    }
    
    // ============== SUCCESS HANDLING ==============
    function showSuccess(registrationNumber) {
      document.getElementById('registrationNumber').textContent = registrationNumber;
      form.style.display = 'none';
      successMessage.style.display = 'block';
      
      // Scroll to success message
      successMessage.scrollIntoView({ behavior: 'smooth' });
    }
    
    // ============== PRINT FUNCTIONALITY ==============
    function printReceipt() {
      const regNumber = document.getElementById('registrationNumber').textContent;
      const regData = JSON.parse(localStorage.getItem('registrationData') || '{}');
      
      const printWindow = window.open('', '_blank');
      printWindow.document.close();
    }
    
    // ============== UTILITY FUNCTIONS ==============
    function formatDate(dateString) {
      if (!dateString) return '-';
      try {
        const date = new Date(dateString);
        return date.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
      } catch (e) {
        return '-';
      }
    }
    
    function showLoading() {
      loadingOverlay.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
    
    function hideLoading() {
      loadingOverlay.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    
    function showNotification(message, type = 'info') {
      // Remove existing notifications
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notif => notif.remove());
      
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
          <span>${message}</span>
        </div>
      `;
      
      // Add to page
      document.body.appendChild(notification);
      
      // Remove after 5 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 5000);
    }
    
    // ============== ERROR HANDLING ==============
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
      showNotification('Terjadi kesalahan tidak terduga. Silakan refresh halaman.', 'error');
    });
    
    window.addEventListener('unhandledrejection', function(e) {
      console.error('Unhandled promise rejection:', e.reason);
      showNotification('Terjadi kesalahan jaringan. Silakan periksa koneksi internet.', 'error');
    });
    
    // ============== BROWSER COMPATIBILITY ==============
    // Check for required features
    if (!window.fetch) {
      showNotification('Browser Anda tidak mendukung fitur yang diperlukan. Silakan gunakan browser yang lebih baru.', 'error');
    }
    
    // ============== DEVELOPMENT HELPERS ==============
    // Uncomment for development/testing
    /*
    window.fillTestData = function() {
      document.getElementById('fullname').value = 'Ahmad Test';
      document.getElementById('birthplace').value = 'Pekanbaru';
      document.getElementById('birthdate').value = '2010-01-01';
      document.getElementById('gender').value = 'Laki-laki';
      document.getElementById('address').value = 'Jl. Test No. 123, Pekanbaru';
      document.getElementById('phone').value = '081234567890';
      document.getElementById('father-name').value = 'Bapak Test';
      document.getElementById('father-occupation').value = 'Petani';
      document.getElementById('mother-name').value = 'Ibu Test';
      document.getElementById('mother-occupation').value = 'Ibu Rumah Tangga';
      document.getElementById('parent-phone').value = '081234567891';
      document.getElementById('education-level').value = 'SLTP';
      document.getElementById('previous-school').value = 'SDN Test';
      document.getElementById('graduation-year').value = '2025';
      document.getElementById('quran-ability').value = 'Menengah';
      document.getElementById('shalat-ability').value = 'Mandiri';
      document.getElementById('payment-date').value = '2025-06-01';
      document.getElementById('payment-name').value = 'Bapak Test';
      console.log('Test data filled');
    };
    */
    
    console.log('=== Form Script Loaded Successfully ===');
    console.log('Current Apps Script URL:', APPS_SCRIPT_URL);
    console.log('Form ready for submission');
  </script>
</body>
</html>